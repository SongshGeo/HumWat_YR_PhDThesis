% 本章研究聚焦于用水者决策过程与环境之间的反馈过程进行建模。
% 使用多主体模型黄河农业灌溉主体对流域水资源分配制度的决策过程，并从“主体规则的设计”、“模块构建与耦合”、“数据输入与分析”三个方面介绍本章的研究方法。

\subsection{主体规则的设计}

本小节将分别从个体尺度、地区尺度、流域尺度介绍多主体模型的规则设计，三者的关系如图\ref{ch6:fig:framework}所示：
（1）个体尺度的灌溉主体是进行农业生产的基本单位，基于环境信息和制度条件做出具体用水决策；
（2）地区是灌溉主体受分水制度影响的主要尺度，流域系统的水资源额度分配体现在主体交互中；
（3）流域尺度给定了模型的环境背景，例如主体分布、水文气候条件、主体交互关系。
% 模型的主要目的是分析流域水资源分配制度如何影响农业灌溉主体的用水来源：用多少地下水？
% 将小麦、玉米、水稻三种主要粮食作物种植用水来源在月尺度区分为自然降水、地表水、地下水，并分析了地表分水制度变化对地下水开采量的影响。

\begin{figure}[!ht]
    \centering
    \includegraphics[width=0.8\textwidth]{img/ch6/ch6_framework.png}
    \caption[多主体模型的设计框架]{多主体模型的设计框架。
        \textbf{A} 自然模块：水文气候条件、流域主体的作物选择和灌溉策略如何影响作物蒸散发。
        \textbf{B} 人类模块（个体尺度）：流域内的灌溉主体在给定水文气候条件、给定配额上限/下限的情况下如何决定其用水来源及用水量；
        \textbf{C} 地区尺度：体现制度变化对区域总可用水配额的影响；
        \textbf{D} 流域尺度：体现流域系统的主体分布、主体网络结构特征对主体博弈决策的影响。
    }\label{ch6:fig:framework}
\end{figure}

\subsubsection{个体尺度：用水决策}

对单个农民主体来说，决策核心是对天然降水之外的作物水亏缺进行人为灌溉补给。
对某个位于$x, y$的农民主体$f$而言，其支持作物生长的总用水$W_f$包括天然降水$W_{prec, x, y}$和取用水$WU_f$两部分，符合式\ref{ch6:eq:w}所示的水平衡：
\begin{equation}
    \label{ch6:eq:w}
    W_f = W_{p} + WU_{f} = \min{prec_{x, y}, ETc_{x, y}} + WU_{f}
\end{equation}

其中$W_{p}$是作物生长利用的天然降水量，等于作物蒸散发和降水量的较小值，根据主体所处的坐标位置（$x, y$）直接从自然模块调用相应属性，作物蒸散发$ETc_{x, y}$则采用国际粮农组织（FAO）推荐的单作物系数法，由潜在蒸散发和作物蒸散发系数$Kc_{x, y}$计算得到（见式\ref{ch6:eq:etc}）。

若降水量大于作物蒸发量，则说明自然降水已经满足作物生长，不再需要额外取水，即$WU_{f} = 0$。对于大多数需要取水灌溉的区域，作物蒸发量$ETc_{x, y} > prec_{x, y}$，可将水亏缺$W_{deficits}$定义为考虑灌溉损失后的作物蒸散发与实际降水量之间的差，且由于在灌溉中不可避免产生水量损失，参考已有研究使用系数$k_{loss}$对其进行修正\cite{chen2023}：
\begin{equation}
    \label{ch6:eq:deficits}
    W_{deficits} = \frac{ETc_{x, y} - prec_{x, y}}{k_{loss}}
\end{equation}

生产实际中不可能做到完全按照作物的水亏缺决定灌溉取水量，实际灌溉水量受到农民经验与节水灌溉设施等多因素影响，因此作物水亏缺$W_{deficits}$和实际灌溉取用水量$WU$之间仍存在较大差异，而二者比例$\frac{W_{deficits}}{WU}$可指示灌溉效率。
本章研究中，对于每个地级市来说实际总取水量$WU$是外生变量，可以直接从外部数据中获取，根据用水量的年际统计数据将尺度下降到月尺度，可得每个地级市在作物生长季在第$i$（$i \in [1, 12]$）月的实际取水量。

本模型在每步模拟中，可将位于$x, y$的灌溉主体$f$的作物生长用水来源$WU_f$进一步分为地表水来源$W_s$和地下水来源$W_g$两部分（$WU = W_g + W_s$），具体用水决策及模型计算顺序如下：
（1）若$W_{deficits} \leq 0$，说明降水已经满足了需求，则作物生长水源$W$就完全由降水提供，即$W = W_p = prec_{x, y}$, $WU_f = W_{s} = W_{g} =0$；
（2）否则，对于需求$WU_f > 0$，假定农民$f$首先考虑从地表水获得，根据自己的地表水资源配额$Q_{0}$进行取水，地表取水量不能超过其可用额度$Q_f$，即$W_s = \min[Q_f, WU_f]$；
（3）最后估计地表水开采量$W_g$，所有降水和地表水仍不被满足的用水需求被认为来自地下水，即$W_g = WU_f - W_s$。
上述判断过程可用式\ref{ch6:eq:wu}进行总结表达：
\begin{equation}
    \label{ch6:eq:wu}
    \begin{cases}
        W_s = W_g = 0, & W_{deficits} \leq 0 \\
        W_s = \min{Q_f, WU_f}, W_g = 0 & W_{deficits} > 0, WU_f < Q_f \\
        W_s = Q_f, W_g = WU_f - W_s & W_{deficits} > 0, WU_f > Q_f
    \end{cases}
\end{equation}

\subsubsection{地区尺度：额度分配}

黄河流域的配额制度通常仅到地级市尺度，如何在地区尺度分配该地区的可供分配的水资源配额取决于主体之间的自组织。
本章研究中假设地区尺度完全根据作物的水亏缺$WU_{deficits}$分配灌溉水量，作为完全的“按需分配”，这是节约配额的理论最优（也是理论最公平的）情景，这也意味着现实中的资源供需匹配不会优于本章研究的模拟结果。
在数学上，假设总地表水配额为$Q_{C}$的地区$C$中包含$n$个主体，则主体$j$的配额$Q_j$为：
\begin{equation}
    \label{ch6:eq:quota}
    Q_j = Q_{C} * \frac{W_{deficits, j}}{\sum_{j \in C} W_{deficits, j}}
\end{equation}

由于第四章中介绍的分水制度差异及其变化，地区$C$的配额并非固定不变的，在1987 \textendash{} 1998年间水资源配额没有被严格执行，使用$Q_{\min}$和$Q_{\max}$两个属性进行表达，允许用水个体的实际地表取用水在其间浮动。
$Q_{\max}$由黄河流域各省在$1983$年自主上报的水资源配额需求基础上降尺度到地区和月份来估算（详见表\ref{ch5:tab:quota}），代表自主取水时期满足该地区主体用水需求的能力上限，通常是官方建议配额$Q_{\min}$的近两倍。
因此，关于$Q_j$的判定规则如公式\ref{ch6:eq:which_quota}所示，与模型当前模拟的年份$yr$有关：

\begin{equation}
    \label{ch6:eq:which_quota}
    Q_j =
    \begin{cases}
        Q_{\max} & \text{when } yr < 1987 \\
        Q_{\in} \leq Q_j \leq Q_{\max} & \text{when } 1987 \leq yr \leq 1998 \\
        Q_{\min} & \text{when } yr > 1998
    \end{cases}
\end{equation}

在$1987 \leq yr \leq 1998$时期，主体$f$在计算配额$Q_f$时如果地表用水需求，其$Q_{0} = Q_{\min}$会保证被优先满足，这是分水方案中明确保证的配额供应。
由于这个配额没有被强制执行，该主体拥有一定的灵活性索取获得超越官方建议配额$Q_{\min}$的额外配额$Q_{1}$，即超出制度规定但不违背需求上限的“违背制度”部分。
该部分配额的值与主体的社会属性有关，和超采的配额$Q_{1}$决定多取用多少配额$Q = Q_{0} + Q_{1}$，详见人类模块的具体介绍，但$Q = Q_{0} + Q_{1}$不会超过该主体能被分配到的最大合理配额$Q_{\max}$。

\subsubsection{流域尺度：环境设定}

在全流域，气候、水文、人口的空间数据精度同化至空间分辨率$res = 0.1^{\circ}$，即每个空间栅格的范围大约为$A_{cell} = 121~{km}^2$，这也是主体进行灌溉活动的基本单元。
本章研究的时间精度是月，考虑作物的生长季主要在$4$月到$8$月之间（见表\ref{ch6:tab:crops}），因此根据统计数据中三类主要作物的灌溉面积和模拟的空间精度来估计每个地级市的主体数量：
\begin{equation}
    n_{C} = \sum_{k=R, M, W}\frac{A_{C, k}}{A_{cell}}
\end{equation}

其中$k = R, M, W$分别代表本研究考虑的三种作物：水稻、玉米和小麦，$A_{C, k}$为该种作物在$C$市的灌溉面积，$A_{cell}$则为每个斑块（栅格）代表的面积。
由于各地级市的灌溉作物面积每年都会变化，每年使用新的统计数据来进行更新主体数量$n_f$。
每个确定的栅格位置$x, y$只能同时存在一个主体$f$，在保证主体数量与灌溉面积一致的基础上，主体的生成位置随机，且概率遵循人口$pop_{x, y}$空间分布的加权平均。

主体决策之间会互相影响，每年的主体数量和位置更新后，还需要预设主体之间的交互关系。
以每个主体为一个节点，存在相互影响的主体间存在连边，那么整个流域可形成一个复杂网络，该网络可包括三种潜在连边：
（1）同一地级市的灌溉主体之间
（2）不同地级市的灌溉主体之间
（3）不同省区的灌溉主体间
由于中国农业基本单元的封闭性，本研究假设不同省之间的主体之间不会互相影响（即不会出现跨省互相影响决策的情况），在同一地级市之内和地级市之间的连边遵循具有固定连边概率的ER随机图（Erdős–Rényi random graphs）构建算法~\cite{maier2019}，即随机图是一个由$nf$个节点组成的图，其中同一地级市每对节点连接的概率为$p_n$，每个省的各地级市存在$nf_{hub, c}$个关键节点，它们每对节点之间的连接概率为$p_c$，三个参数共同确定了全流域范围内所有灌溉主体之间可能互相影响的网络拓扑。
本章研究中，参数$nf_{hub, c}, p_n$，$p_C$参考Santos等人的研究外生给定\cite{santos2008}，以对比其研究中提出的最适宜公共池塘博弈决策传播的“星形网络”。

\input{chapter6/source/tab_crops.tex}

\subsection{模块构建与耦合}

在上述规则构架下，本研究包括两个关键模块：
（1）人类模块：流域内的灌溉主体在给定水文气候条件、给定配额上限/下限的情况下如何决定其用水来源及用水量；
（2）自然模块：水文气候条件、流域主体的作物选择和灌溉策略如何影响作物蒸散发。
本节先分别介绍两个模块的运行过程，最后介绍二者间的耦合反馈关系。

\subsubsection{人类模块}\label{ch6:sec:society}

在人类模块中，本研究使用演化公共池塘博弈的分析框架对主体面对配额限制的决策响应进行分析，使用遵循配额（$C$）与违背配额（$D$）来概括主体在面对灵活水配额制度（1987年至1987年间）的基本决策。
博弈论（Game Theory）是研究决策者之间战略互动的数学模型，是研究具有竞争性质现象的理论和方法，对于公共水配额这种竞争性、排他性都很强的“公共池塘资源”，符合演化公共物品博弈的模型框架\cite{ostrom2009, traulsen2010}。
本研究中，主体$i$选择是否遵循限制地表用水的配额制度（$S_i = 1$表示合作$C$，$S_i=0$代表决策$D$），构成演化公共池塘博弈框架。
如果某个主体同意严格遵循配额制度$Q = Q_{\min}$，那么他将损失潜在收益$c$中的一部分。
如果每个人都遵循配额（选择合作$C$），那么共同投资的总额可能会变成原来的$r$倍，并在所有参与的投资者中平分。
如果有$N$个代理人参与，那么每个人的博弈收入$E$由两部分组成（见公式\ref{ch6:eq:game}）：$-c*S_i$ 代表单个主体对集体贡献的成本，而 $\sum_{j=1}^N S_j$则代表共同利益池给每个贡献的主体分到的利益：
\begin{equation}
    \label{ch6:eq:game}
    E=-c * S_i+\frac{r c}{N} \sum_{j=1}^N S_j=-\left(c-\frac{r}{N}\right) S_i+\frac{r c}{N} \sum_{j \neq 1}^N S_j
\end{equation}

在本研究中，黄河分水制度对于遵循配额的主体没有任何额外的经济补贴（这被视为一种行政上的义务），也没有正式的经济上的行政处罚，因此公共池塘的收益系数$r = 1$，即维护公共池塘的集体收益为$0$。
此外，由于黄河流域灌区的地下水取水的成本普遍高于地表取水，潜在成本$c$与地下水开采量$W_g$有关，使用$c = W_g$表示，意味着地下水水费每单位较地表水贵一个单位。
因为本研究后续影响主体决策的是主体间的收入差距，而所有主体的潜在收益$E$与地下水取水量都是同样的线性关系，决定主体收益差距仅由地下水开采量$W_g$的差距决定。

对遵循配额的行为不存在任何补贴制度，对违背配额的农民个体实际上也不存在经济惩罚，影响主体是否遵循配额的另一个主要驱动因素是社会规范，因为违背制度通常是不被提倡的。
多元理性理论是一个理解个人决策与社会规范影响之间关系的经典框架，指出由“个体/集体主义”与“注重/轻视规范”两个维度，就可以预测不同文化背景下遵循社会规范的倾向\cite{verweij2015}，因此可以对复杂的政策问题进行结构化的诊断，因此该方法框架已被应用于解释水治理的成功与失败。
参考 Castilla-Rho 等人基于多元理性（Plural rationality theory PRA）的社会理论的一系列研究，可以使用两个简单的参数$b$和$v$来测量主体遵循制度规范的动因\cite{castilla-rho2015, castilla-rho2017, castilla-rho2020}。
其中$b\in[0, 1]$表征某主体“注重/轻视规范”的程度，在模型中也是该主体突破规定配额，做出决策$D$的概率。
$v \in [0, 1]$则表征主体“个体/集体主义”的程度，该参数越大代表主体越重视与他人保持一致，在模型中是对该主体社交网络中违规行为进行负面评判的概率。
考虑到人们不愿意主动得罪别人，也不愿意丧失名誉，这种评价将成为计算社会得分的基础，采用在福利经济学中常用的Cobb-Douglas函数的形式进行表达：
% Cobb-Douglas函数(https://inomics.com/terms/cobb-douglas-production-function-1456726)
% [Happy Planet Index](https://happyplanetindex.org/) 
% 人类发展指数(http://hdr.undp.org/en)
\begin{equation}
    S = {(grid)}^m * {(1 - group)}^n
    \label{ch6:eq:society}
\end{equation}

其中 $m$ 是一个主体发现其它人违规超配额用水的次数，$n$ 则是他被他人发现超配额用水的次数。
即$grid^m$ 这部分表达的是主体因周围人违背制度规范而感到不舒服；$group^n$ 这部分表达的是一个主体违背制度规范而被周围人指指点点而感到不舒服。
$grid$与$group$是反映社会整体平均$b$与$v$水平的参数。

决策在演化博弈中可根据其适应得分发生演化。
人类模块每年计算所有主体的博弈结果——$0$ \textendash{} $1$标准化后的经济得分（$E$）与社会得分（$S$），并将两者平均作为主体的最终得分，即：
\begin{equation}
    \label{ch6:eq:score}
    Score = E * S
\end{equation}

在社会网络中，表现最成功的主体决策将被与它有社会联系的其他主体学习，学习后的主体使用被学习对象的$b$和$v$参数代替学习者原本的参数。

\subsubsection{自然模块}

在自然模块中，本研究使用 FAO56 推荐的算法计算潜在蒸散发$ET_0$、作物蒸散系数$Kc$、以及作物蒸散发$ET_c$：
\begin{equation}
    ET_c = ET_0 * Kc * Ks
    \label{ch6:eq:etc}
\end{equation}

其中$Ks$是水压力系数，主要与土壤质地有关。由于在本研究中仅考虑三种主要粮食作物，且主要分布在灌溉条件良好的土壤上，对此系数的空间分异不再作进一步考虑，使用系数$Ks = 0.3$进行估计，作物蒸散发系数$Kc$的同样通过查阅采用国际粮农组织（FAO56）推荐的作物表得到（表\ref{ch6:tab:crops}）\cite{chen2023}，潜在蒸散发$ET_0$的计算方法使用Penman-Monteith方法，式\ref{ch6:eq:pm}：
\begin{equation}
    \label{ch6:eq:pm}
    PET = \frac{0.408 \Delta (R_{n}-G)+\gamma \frac{900}{T+273}
    (e_s-e_a) u_2}{\Delta+\gamma(1+0.34 u_2)}
\end{equation}
其中$Rn$为作物表面上的净辐射，单位是$MJ/(m^2 day)$；$G$为土壤热通量，单位是$MJ/(m^2 day)$；$T$为$2$米高处日平均气温，单位是$^\circ C$；$u_2$为$2$米高处的风速，单位是$m/s$；$es$为饱合水汽压，单位是$kPa$；$ea$为实际水汽压，单位是$kPa$；$r$为湿度计常数，单位是$kPa/^\circ C$。
由于计算的时间精度为逐月，土壤热通量可以忽略。根据其它数据可得性，对经验公式\ref{ch6:eq:pm}中的饱和水汽压$es$使用气温数据进行估算：
\begin{equation}
    es = \frac{e^0(T_{\max}) + e^0(T_{\min})}{2}
\end{equation}
其中：
\begin{equation}
    e^0(T) = 0.6108 * \exp \frac{17.27 T}{T + 237.3}
\end{equation}

作物生长期间的作物系数$Kc$的曲线是用三个阶段的作物系数来估计的：初期（$Kc_{ini}$）、中期（$Kc_{mid}$）和后期（$Kc_{end}$）。
作物系数的各转折点以表\ref{ch6:tab:crops}中的数据为依据进行定位。
$Kc_{ini}$的计算方法参考Chen等人的研究\cite{chen2023}。

\subsubsection{人地模块的耦合}

本章研究的模型在基于地理数据的多主体建模框架“ABSESpy”基础上搭建，这是一个多主体建模开源框架软件包\cite{song2023}。
该框架使用真实的地理空间数据集来构建人工社会生态系统，同时充分考虑人类行为因素。
它支持使用地理空间数据，对具有认知、社会影响和反应等行为的主体进行建模，用户可以专注于分别实现人类行为的逻辑和自然过程的仿真，该框架使得两者之间能够轻松地访问和修改变量值，该框架可以调度任意数量的自然模块和社会模块，并使它们之间松散耦合。

在本章研究中，人类用水模块通过作物种植来改变自然模块的作物地表覆被属性，自然模块则通过降水、地表蒸散发的变化来影响人类用水模块中的决策环境，主体可以根据其所在位置调用相关的自然属性，所有主体、环境间相互感知能力如表\ref{ch6:tab:visa3}所示，主体的所有模型行为总结在表\ref{ch6:tab:visa4}中。每次模拟都遵循图\ref{ch6:fig:society}所示的流程，每个主体都将遵循``更新社会''所示的计算流程。

\begin{figure}[!ht]
    \centering
    \includegraphics[width=0.8\textwidth]{img/ch6/ch6_updates_diagram.png}
    \caption[多主体模型的更新规则与模拟流程]{多主体模型的更新规则与模拟流程。
    左侧表示多主体模型整体运行的大致流程，“更新社会”步骤是人类模块进行决策的部分，包括五个主要步骤：
        （1）主体根据自己当前的$b$属性（“注重/轻视规范”）作为选择合作的概率，决定本轮中使用的决策“C/D”。
        （2）若当前主体选择不合作（D），其余选择合作（C）的主体根据其$v$属性（“个体/集体主义”）决定是否对其进行社会规范上的谴责。
        （3）对每个主体按照谴责他人/被他人谴责的次数估计自己的社会收益$S$。
        （4）综合社会收益$S$和经济收益$E$，每个主体都将学习自己朋友中综合表现最好的个体，模仿他的$v$和$b$属性，若自己的表现就是朋友中最好的，则跳过此步骤。
        （5）为避免模型陷入局部最优，以极小概率（$\alpha = 5\%$）对主体的策略进行变异，设置$v, b \in [0, 1]$成新的随机数。
    }\label{ch6:fig:society}
\end{figure}

\input{chapter6/source/tab_visa2.tex}

% Table generated by Excel2LaTeX from sheet '主体感知'
\begin{table}[htbp]
    \centering
    \caption{多主体模型中主体与环境的感知情况$^a$}
      \begin{tabularx}{0.6\textwidth}{LLL}
      \toprule
            & 环境    & 农民 \\
      \midrule
      环境    & $*$     & \{$f_{crop} \dots$\} \\
      农民    & $prec$, $ET_c$ & $[*] d, p, b, v$ \\
      \bottomrule
      \end{tabularx}\label{ch6:tab:visa3}\\%
    \footnotesize{$a$从左到右读该表，方括号内*代表主体可以自我感知所有属性，方括号外则是感知其他同类主体的属性。}
\end{table}%

\input{chapter6/source/tab_visa4.tex}
\subsection{数据处理}

\subsubsection{输入数据}

本章研究使用的数据清单如表\ref{ch6:tab:dataset}所示，包括气象数据、作物物候数据、灌溉面积和灌溉用水数据、用水配额数据、人口数据等，其中较为重要且需要预处理的主要是来自黄河水利委员会公开的水资源配额数据。
该数据仅在2014年后才公开了逐月精度的数据，但包括了每个月水量相较于多年平均水平相差的百分比（即表\ref{ch6:tab:dataset}中所示的距平）。
因此，本研究首先根据该距平值将逐月的配额推演至多年平均水平，进一步假设该水量分配是按各地区实际需求分配的，利用用水量数据将省尺度的配额降尺度到地级市。
例如，对某个属于$I$省的地级市$i$在月份$j$内的灌溉用水配额$Q_{ij}$可以用该地区的用水量$WU_{i, j}$占比进行估计：
\begin{equation}
    \label{ch6:eq:quota_data}
    Q_{ij} = Q_{I, j} \times \frac{WU_{i, j}}{\sum_{j = 1, 2, \dots, 12} WU_{I}}
\end{equation}

由于此分水水量包括了所有产业、所有类型灌溉耕地，所以通过式\ref{ch6:eq:quota_data}计算所得该分水额度$Q$需要进行进一步按比例作细化处理：
\begin{equation}
    Q_{W, R, M} = W_{W, R, M} / WU_{sum} \times Q
\end{equation}

其中$W, R, M$分别是本研究主要关注的小麦、水稻、玉米三种黄河流域主要作物的用水量，$WU_{sum}$为该地区的总用水量，利用两者的比例作为系数对此地区的用水额度作进一步按需分配，作为本研究多主体模型中研究三种作物所使用的额度数据。

\input{chapter6/source/tab_dataset.tex}

\subsubsection{参数选取}

本研究所有的参数（见表\ref{ch6:tab:visa2.env}、表\ref{ch6:tab:visa2.hum}）估计都有前人研究作为参考，需要特别说明的参数选取及其意义主要有三部分：
（1）影响人类模块得分计算的两个社会效用函数在过往的研究中已经被多次使用，且基于问卷数据进行了较为可靠的估计，本研究直接参考Castilla-Rho 研究中从世界价值观调查数据库中对这两个参数的估计值\cite{castilla-rho2015, castilla-rho2017, castilla-rho2020}。
（2）自然模块的$Ks$是水压力系数，主要与土壤质地有关。由于在本研究中仅考虑三种主要粮食作物，且主要分布在灌溉条件良好的土壤上，对此系数的空间分异不再作进一步考虑，使用系数$Ks = 0.3$进行估计。灌溉损失系数则是经验值$0.8$，代表无论如何都有$20\%$的水分会在灌溉中损失掉。
（3）人类模块的$p_l$概率、模型规则中的$p_n$、$p_C$参数都与社会网络的形成有关。
Francisco 等人的研究已经对网络结构对演化博弈决策行为传播的影响做了很经典的研究\cite{santos2008}，本研究将三个概率参数均设置为$1$，即每个省区都将形成典型的“星形网络”，根据其研究结果，这是一种促进决策传播的有效结构，广泛存在且与已有文献之间具备可对比性\cite{santos2008}。
此外，根据罗家德等人的研究，这也较为符合我国地方社会“以能人为核心”的关系网络结构\cite{luojiade2013}。

\subsubsection{模型校验}

本章使用黄河水资源公报$2002$年至$2013$年提供的地下水和地表水统计资料进行模型的校验，该统计资料与作为模型输入的根据用水强度估算的用水量属于不同统计来源，因此可以用于校验。
式\ref{ch6:eq:verify}中模型校验使用的指标是灌溉用地下水所占比例，由于模型仅对三种主要粮食作物的灌溉用水进行计算，对应水资源公报中的“农田灌溉”用水数据，使用该数据与模型的预测结果计算第$t$年的均方根误差$RMSE_t$：
\begin{equation}
    \label{ch6:eq:rmse}
    RMSE_t = \sqrt{\frac{1}{n}*\sum_{i=1}^{n}{(y_t - \hat{y_t})}^2}
\end{equation}

公式中的 $\sum_{i=1}^{n}{(y_i - \hat{y_i})}^2$ 表示对每个样本的预测值与真实值之差的平方求和，然后除以样本数量 $n$（黄河的相关省份 $n = 8$），最后再对结果求平方根，得到均方根误差的值。$y_i$ 是样本的真实值，$\hat{y_i}$ 是预测值，本研究使用地下水占地下水+地表水的比例进行误差校准：
\begin{equation}
    \label{ch6:eq:verify}
    y = \frac{Wg}{Ws + Wg}
\end{equation}

模型校验的结果如表\ref{ch6:tab:rmse}所示，可见除个别省份外，均方根误差都保持在$0.15$以内。

\input{chapter6/source/tab_rmse.tex}

\subsubsection{分析方法和建模工具}

本研究使用广义加性模型（Generalized Additive Models, GAM）分析地区用水量随时间变化的趋势，这是一种广泛应用于回归分析的非参数统计模型。
相比于线性回归模型，GAM 没有对因变量和自变量之间的关系做出先验假设，因此在数据非线性、非正态分布、存在交互作用等情况下更具有优势。
GAM 通过使用光滑的非参数函数（如样条函数）对自变量的影响进行建模，同时也可以应用广义线性模型中的方法来对非正态数据进行回归分析。所有模型使用Python软件3.11版本进行构建。
% 本章构建的多主体模型暂时不予以开源，但具体构建方式已在上述方法中进行了详尽描述。

% \input{chapter6/source/tab_packages.tex}
